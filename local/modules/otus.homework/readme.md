# Модуль 24.12

## Алгоритм создания

- install/index.php
- добавим обработчик события
- создадим инфоблок ТЕСТ
- внутри обработчика события вызовем кастомный компонент
- кастомный компонент выводит связанные со сделкой элементы инфоблока ТЕСТ
- протестируем

## Создание компонента вывода списка элементов Инфоблока ТЕСТ

- В class.php - реализовать получение элементов ИБ
- Подготовить данные для вывода в гриде (main.ui.grid)

# Компонент `otus.homework:otus.grid`

Кастомный компонент для отображения данных в виде таблицы (`main.ui.grid`) внутри карточки CRM (например, Сделки). Реализован с использованием ленивой загрузки (lazyload) через вкладку CRM.

---

## Структура

### `/bitrix/components/otus.homework/otus.grid/`

- **`class.php`**  
  Основной класс компонента:
    - Загружает JS-библиотеку `ui.grid`.
    - Получает данные из таблицы `ClientsTable`.
    - Подготавливает `arResult['ITEMS']` и `GRID_ID`.
    - Подключает шаблон.

- **`template.php`**  
  Отрисовка грида (`main.ui.grid`) с колонками и данными из `$arResult`.

- **`lazyload.ajax.php`**  
  Ajax-обработчик для ленивой подгрузки:
    - Получает `DEAL_ID` из запроса.
    - Подключает компонент `otus.grid`.
    - Возвращает HTML с таблицей.

---

### `local/modules/otus.homework/lib/Crm/Handlers.php`

Обработчик события CRM:

- Подписан на `onEntityDetailsTabsInitialized`.
- Добавляет новую вкладку в карточку CRM.
- Задает `serviceUrl` для подгрузки содержимого вкладки.

---

## Что такое Lazyload и AJAX?

### Lazyload (ленивая загрузка)
Lazyload — это техника, при которой содержимое (например, компонент или HTML-блок) не загружается сразу при открытии страницы, а только когда оно реально нужно — например, при переключении на вкладку.

**Зачем нужно?**
- Ускоряет начальную загрузку страницы
- Экономит ресурсы сервера и клиента
- Удобна при работе с компонентами Bitrix в CRM

### AJAX (Asynchronous JavaScript and XML)
AJAX — это технология, позволяющая загружать данные с сервера без перезагрузки страницы. В контексте Bitrix это означает вызов PHP-файла (например, `lazyload.ajax.php`), который возвращает только нужный HTML или данные.

**Плюсы:**
- Быстрая подгрузка данных
- Без перезагрузки страницы
- Позволяет динамически обновлять интерфейс

---